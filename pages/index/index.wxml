<!-- 首页 - 授权和标段选择 -->
<view class="container">
    <!-- 顶部图标和标题 -->
    <view class="header">
        <view class="logo-container">
            <view class="logo-circle">
                <image src="/images/shield-icon.png" class="shield-icon" mode="aspectFit"></image>
            </view>
        </view>

        <view class="title-section">
            <text class="main-title">中泰段智慧安全隐患系统</text>
            <text class="sub-title">320国道余杭中泰段工程项目</text>
        </view>
    </view>

    <!-- 授权状态检查 -->
    <view wx:if="{{!isAuthorized}}" class="auth-section">
        <view class="auth-content">
            <view class="auth-icon">👤</view>
            <view class="auth-title">欢迎使用安全举报系统</view>
            <view class="auth-desc">使用前需要获取您的个人信息以确保使用安全</view>
        </view>

        <view class="auth-buttons">
            <button class="auth-btn" bindtap="getUserProfile">
                <text class="btn-icon">✓</text>
                <text class="btn-text">微信授权登录</text>
            </button>
        </view>
    </view>

    <!-- 用户信息展示 -->
    <view wx:else class="user-info-section">
        <view class="user-avatar">
            <image wx:if="{{userInfo.avatarUrl}}" src="{{userInfo.avatarUrl}}" class="avatar-img" mode="aspectFill"></image>
            <view wx:else class="default-avatar">👤</view>
        </view>
        <view class="user-details">
            <text class="user-name">{{userInfo.nickName || '微信用户'}}</text>
            <text class="user-status">已授权登录</text>
        </view>
        <!-- 认证状态 -->
        <view class="verification-status" bindtap="goToVerification">
            <view wx:if="{{isVerified}}" class="verified-status">
                <text class="status-icon">✓</text>
                <text class="status-text">已认证</text>
            </view>
            <view wx:else class="unverified-status">
                <text class="status-icon">!</text>
                <text class="status-text">未认证</text>
            </view>
        </view>
    </view>

    <!-- 标段选择 -->
    <view wx:if="{{isAuthorized}}" class="section-selection">
        <view class="section-title">请选择您所在的标段</view>
        <view class="section-list">
            <view wx:for="{{sections}}" wx:key="code" class="section-item" 
                  data-section="{{item.code}}" 
                  data-section-info="{{item.info}}" 
                  bindtap="selectSection">
                <view class="section-name">{{item.name}}</view>
                <view class="section-code">{{item.code}}</view>
            </view>
        </view>
    </view>
</view>

<!-- 昵称头像填写弹窗 -->
<view wx:if="{{showNicknameModal}}" class="nickname-modal-overlay">
    <view class="nickname-modal">
        <view class="modal-header">
            <text class="modal-title">完善个人信息</text>
            <text class="modal-subtitle">请填写您的昵称和选择头像</text>
        </view>
        
        <view class="modal-content">
            <!-- 头像选择 -->
            <view class="avatar-section">
                <text class="section-label">头像</text>
                <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="chooseAvatar">
                    <image class="avatar-preview" src="{{tempAvatarUrl}}" mode="aspectFill"></image>
                    <text class="avatar-tip">点击选择头像</text>
                </button>
            </view>
            
            <!-- 昵称输入 -->
            <view class="nickname-section">
                <text class="section-label">昵称</text>
                <input 
                    class="nickname-input" 
                    type="nickname" 
                    placeholder="请输入您的昵称" 
                    value="{{tempNickname}}"
                    bindinput="onNicknameInput"
                    maxlength="20"
                />
            </view>
        </view>
        
        <view class="modal-buttons">
            <button class="cancel-btn" bindtap="cancelUserInfo">取消</button>
            <button class="confirm-btn" bindtap="confirmUserInfo">确认</button>
        </view>
    </view>
</view>
