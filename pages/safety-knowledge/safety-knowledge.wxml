<!-- å®‰å…¨çŸ¥è¯†é¡µé¢ -->
<wxs module="utils" src="utils.wxs"></wxs>
<view class="safety-knowledge-page">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <view class="header">
        <view class="back-btn" bindtap="goBack">
            <text>â† è¿”å›</text>
        </view>
        <view class="title">å®‰å…¨çŸ¥è¯†</view>
    </view>

    <!-- é¡µé¢å†…å®¹ -->
    <scroll-view class="content" scroll-y="true">
        <!-- å®‰å…¨çŸ¥è¯†åº“ä»‹ç» -->
        <view class="intro-section">
            <view class="intro-card">
                <view class="intro-header">
                    <text class="intro-icon">ğŸ“š</text>
                    <text class="intro-title">å®‰å…¨ç”Ÿäº§çŸ¥è¯†åº“</text>
                </view>
                <text class="intro-desc">æ¬¢è¿è®¿é—®320å›½é“ä½™æ­ååè‡³å¯Œé˜³é«˜æ¡¥æ®µå·¥ç¨‹é¡¹ç›®å®‰å…¨çŸ¥è¯†åº“ï¼Œè¿™é‡Œæœ‰ä¸°å¯Œçš„å®‰å…¨å­¦ä¹ èµ„æ–™ä¾›æ‚¨å­¦ä¹ ã€‚</text>
            </view>
        </view>

        <!-- å®‰å…¨çŸ¥è¯†åˆ†ç±»åˆ—è¡¨ -->
        <view class="categories-section">
            <view class="section-title">å®‰å…¨çŸ¥è¯†åˆ†ç±»</view>
            <view class="categories-list">
                <block wx:for="{{categories}}" wx:key="id">
                    <!-- åˆ†ç±»æ ‡é¢˜å¡ç‰‡ -->
                    <view class="category-card {{expandedCategories[item.id] ? 'expanded' : ''}}"
                          bindtap="toggleCategory"
                          data-id="{{item.id}}">
                        <view class="card-header">
                            <view class="card-left">
                                <view class="card-icon">ğŸ“</view>
                                <view class="card-info">
                                    <text class="card-title">{{item.name}}</text>
                                    <text class="card-meta">{{item.description || 'æš‚æ— æè¿°'}} Â· {{item.articles.length || 0}} ç¯‡æ–‡ç« </text>
                                </view>
                            </view>
                            <view class="card-arrow {{expandedCategories[item.id] ? 'rotated' : ''}}">
                                <text>â–¼</text>
                            </view>
                        </view>
                    </view>

                    <!-- å±•å¼€çš„åˆ†ç±»å†…å®¹åŒºåŸŸ -->
                    <view class="category-content-section {{expandedCategories[item.id] ? 'show' : ''}}"
                          wx:if="{{expandedCategories[item.id]}}">
                        <!-- åŠ è½½çŠ¶æ€ -->
                        <view class="loading-state" wx:if="{{item.loading}}">
                            <text class="loading-text">åŠ è½½ä¸­...</text>
                        </view>

                        <!-- æ–‡ç« åˆ—è¡¨ï¼ˆç›´æ¥æ˜¾ç¤ºå†…å®¹ä¸é™„ä»¶ï¼Œæ— éœ€ç‚¹å‡»å±•å¼€ï¼‰ -->
                        <view class="articles-list" wx:if="{{!item.loading}}">
                            <block wx:for="{{item.articles}}" wx:key="id" wx:for-item="article">
                                <view class="article-content-section show">
                                    <!-- æ–‡ç« å†…å®¹ -->
                                    <view class="content-block">
                                        <view class="content-label">ğŸ“ å†…å®¹</view>
                                        <view class="content-text">
                                            <text>{{article.content}}</text>
                                        </view>
                                    </view>

                                    <!-- é™„ä»¶åˆ—è¡¨ -->
                                    <view class="attachments-block" wx:if="{{article.attachments && article.attachments.length > 0}}">
                                        <view class="content-label">ğŸ“ é™„ä»¶</view>
                                        <view class="attachments-grid">
                                            <view class="attachment-item"
                                                  wx:for="{{article.attachments}}"
                                                  wx:for-item="attachment"
                                                  wx:key="name"
                                                  bindtap="previewAttachment"
                                                  data-attachment="{{attachment}}">
                                                <view class="attachment-preview">
                                                    <view class="file-icon">{{utils.getFileIcon(attachment.name)}}</view>
                                                    <view class="file-info">
                                                        <text class="file-name">{{attachment.name}}</text>
                                                        <text class="file-size">{{utils.formatFileSize(attachment.size)}}</text>
                                                    </view>
                                                    <view class="preview-tag">é¢„è§ˆ</view>
                                                </view>
                                            </view>
                                        </view>
                                    </view>
                                </view>
                            </block>

                            <!-- åˆ†ç±»å†…æ— æ–‡ç« çŠ¶æ€ -->
                            <view class="empty-state" wx:if="{{item.articles.length === 0}}">
                                <text class="empty-icon">ğŸ“</text>
                                <text class="empty-text">è¯¥åˆ†ç±»æš‚æ— æ–‡ç« </text>
                            </view>
                        </view>
                    </view>
                </block>
            </view>

            <!-- æ— åˆ†ç±»çŠ¶æ€ -->
            <view class="empty-state" wx:if="{{categories.length === 0}}">
                <text class="empty-icon">ğŸ“š</text>
                <text class="empty-text">æš‚æ— å®‰å…¨çŸ¥è¯†åˆ†ç±»</text>
            </view>
        </view>
    </scroll-view>
</view>