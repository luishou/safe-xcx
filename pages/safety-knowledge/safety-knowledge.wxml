<!-- å®‰å…¨çŸ¥è¯†é¡µé¢ -->
<wxs module="utils" src="utils.wxs"></wxs>
<view class="safety-knowledge-page">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <view class="header">
        <view class="back-btn" bindtap="goBack">
            <text>â† è¿”å›</text>
        </view>
        <view class="title">å®‰å…¨çŸ¥è¯†</view>
    </view>

    <!-- é¡µé¢å†…å®¹ -->
    <scroll-view class="content" scroll-y="true">
        <!-- å®‰å…¨çŸ¥è¯†åº“ä»‹ç» -->
        <view class="intro-section">
            <view class="intro-card">
                <view class="intro-header">
                    <text class="intro-icon">ğŸ“š</text>
                    <text class="intro-title">å®‰å…¨ç”Ÿäº§çŸ¥è¯†åº“</text>
                </view>
                <text class="intro-desc">æ¬¢è¿è®¿é—®320å›½é“ä½™æ­ååè‡³å¯Œé˜³é«˜æ¡¥æ®µå·¥ç¨‹é¡¹ç›®å®‰å…¨çŸ¥è¯†åº“ï¼Œè¿™é‡Œæœ‰ä¸°å¯Œçš„å®‰å…¨å­¦ä¹ èµ„æ–™ä¾›æ‚¨å­¦ä¹ ã€‚</text>
            </view>
        </view>

        <!-- å®‰å…¨çŸ¥è¯†æ–‡ç« åˆ—è¡¨ -->
        <view class="articles-section">
            <view class="section-title">å®‰å…¨çŸ¥è¯†å†…å®¹</view>
            <view class="articles-list">
                <block wx:for="{{articles}}" wx:key="id">
                    <!-- æ ‡é¢˜å¡ç‰‡ -->
                    <view class="article-card {{expandedArticles[item.id] ? 'expanded' : ''}}"
                          bindtap="toggleArticle"
                          data-id="{{item.id}}">
                        <view class="card-header">
                            <view class="card-left">
                                <view class="card-icon">ğŸ“‹</view>
                                <view class="card-info">
                                    <text class="card-title">{{item.title}}</text>
                                    <text class="card-meta">{{item.uploadTime}} Â· {{item.uploadedBy || 'ç³»ç»Ÿç®¡ç†å‘˜'}}</text>
                                </view>
                            </view>
                            <view class="card-arrow {{expandedArticles[item.id] ? 'rotated' : ''}}">
                                <text>â–¼</text>
                            </view>
                        </view>

                        <!-- é™„ä»¶æç¤º -->
                        <view class="card-attachments-hint" wx:if="{{item.attachments && item.attachments.length > 0}}">
                            <text class="hint-text">ğŸ“ åŒ…å« {{item.attachments.length}} ä¸ªé™„ä»¶</text>
                        </view>
                    </view>

                    <!-- å±•å¼€çš„å†…å®¹åŒºåŸŸ -->
                    <view class="article-content-section {{expandedArticles[item.id] ? 'show' : ''}}"
                          wx:if="{{expandedArticles[item.id]}}">
                        <!-- æ–‡ç« å†…å®¹ -->
                        <view class="content-block">
                            <view class="content-label">ğŸ“ å†…å®¹</view>
                            <view class="content-text">
                                <text>{{item.content}}</text>
                            </view>
                        </view>

                        <!-- åˆ†ç±»ä¿¡æ¯ -->
                        <view class="category-block" wx:if="{{item.categoryId}}">
                            <view class="content-label">ğŸ·ï¸ åˆ†ç±»</view>
                            <view class="category-tag">
                                <text class="category-name">{{item.categoryName || 'å®‰å…¨çŸ¥è¯†'}}</text>
                            </view>
                        </view>

                        <!-- é™„ä»¶åˆ—è¡¨ -->
                        <view class="attachments-block" wx:if="{{item.attachments && item.attachments.length > 0}}">
                            <view class="content-label">ğŸ“ é™„ä»¶</view>
                            <view class="attachments-grid">
                                <view class="attachment-item"
                                      wx:for="{{item.attachments}}"
                                      wx:for-item="attachment"
                                      wx:key="name"
                                      bindtap="previewAttachment"
                                      data-attachment="{{attachment}}">
                                    <view class="attachment-preview">
                                        <view class="file-icon">{{utils.getFileIcon(attachment.name)}}</view>
                                        <view class="file-info">
                                            <text class="file-name">{{attachment.name}}</text>
                                            <text class="file-size">{{utils.formatFileSize(attachment.size)}}</text>
                                        </view>
                                        <view class="preview-tag">é¢„è§ˆ</view>
                                    </view>
                                </view>
                            </view>
                        </view>
                    </view>
                </block>
            </view>

            <!-- ç©ºçŠ¶æ€ -->
            <view class="empty-state" wx:if="{{articles.length === 0}}">
                <text class="empty-icon">ğŸ“š</text>
                <text class="empty-text">æš‚æ— å®‰å…¨çŸ¥è¯†å†…å®¹</text>
            </view>
        </view>
    </scroll-view>
</view>