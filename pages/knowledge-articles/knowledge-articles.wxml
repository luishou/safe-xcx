<!-- 安全知识文章管理 -->
<wxs module="utils" src="utils.wxs"></wxs>
<view class="page">
  <view class="top-nav">
    <view class="back-btn" bindtap="goBack"><text>← 返回</text></view>
    <view class="title">{{categoryName}} - 安全知识管理</view>
  </view>

  <scroll-view class="content" scroll-y="true">
    <!-- 分类与安全知识统一编辑 -->
    <view class="form-card">
      <view class="form-title">分类与安全知识</view>
      <input class="input" placeholder="安全分类" value="{{category.name}}" bindinput="onCategoryNameInput" />
      <textarea class="textarea" placeholder="请输入安全知识内容" value="{{knowledge.content}}" bindinput="onKnowledgeInput" />

      <!-- 附件上传 -->
      <view class="attachment-section">
        <view class="section-header">
          <view class="section-title">附件上传</view>
          <view class="attachment-tips">支持格式：Word(.doc, .docx)、PDF(.pdf)，最大10MB</view>
        </view>

        <view class="attachment-list" wx:if="{{attachments && attachments.length > 0}}">
          <view class="attachment-item" wx:for="{{attachments}}" wx:key="index">
            <view class="attachment-info">
              <view class="file-icon {{utils.getFileType(item.name)}}">
                <block wx:if="{{utils.getFileType(item.name) === 'pdf'}}">📄</block>
                <block wx:elif="{{utils.getFileType(item.name) === 'word'}}">📝</block>
                <block wx:else>📎</block>
              </view>
              <view class="file-details">
                <text class="attachment-name">{{item.name}}</text>
                <text class="file-size">{{utils.formatFileSize(item.size)}}</text>
              </view>
            </view>
            <view class="attachment-actions">
              <button class="remove-btn" size="mini" bindtap="removeAttachment" data-index="{{index}}">删除</button>
            </view>
          </view>
        </view>

        <button class="upload-btn" bindtap="uploadAttachment">
          <view class="upload-content">
            <view class="upload-icon">📁</view>
            <view class="upload-text">
              <text class="upload-main">选择文件</text>
              <text class="upload-sub">或拖拽文件到此处</text>
            </view>
          </view>
        </button>
      </view>

      <button class="primary-btn" bindtap="saveAll">保存</button>
    </view>
  </scroll-view>
</view>