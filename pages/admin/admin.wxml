<!-- å®‰å…¨ç¯ä¿éƒ¨ç®¡ç†ç•Œé¢ -->
<view class="manager-view">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <view class="top-nav">
        <view class="back-btn" bindtap="goBack">
            <text>â† è¿”å›</text>
        </view>
        <view class="nav-title">{{currentSection.section_name || ('ç¬¬' + currentSection + 'æ ‡æ®µ')}} - å®‰å…¨ç¯ä¿éƒ¨</view>
    </view>

    <!-- é¡¶éƒ¨å›¾æ ‡èœå•ï¼šç»Ÿè®¡ / ä»»åŠ¡ä¸­å¿ƒ -->
    <view class="icon-menu">
        <!-- å·¦ä¾§ï¼šä»»åŠ¡ä¸­å¿ƒ -->
        <view class="icon-card {{currentPanel === 'tasks' ? 'selected' : ''}}" bindtap="showTasksPanel">
            <text class="icon-emoji">ğŸ—‚ï¸</text>
            <text class="icon-label">ä»»åŠ¡ä¸­å¿ƒ</text>
        </view>
        <!-- å³ä¾§ï¼šç»Ÿè®¡ -->
        <view class="icon-card {{currentPanel === 'stats' ? 'selected' : ''}}" bindtap="showStatsPanel">
            <text class="icon-emoji">ğŸ“ˆ</text>
            <text class="icon-label">ç»Ÿè®¡</text>
        </view>
        <!-- æ–°å¢ï¼šå®‰å…¨çŸ¥è¯†ç®¡ç†å…¥å£ -->
        <view class="icon-card" bindtap="goKnowledgeAdmin">
            <text class="icon-emoji">ğŸ“š</text>
            <text class="icon-label">å®‰å…¨çŸ¥è¯†</text>
        </view>
    </view>

    <!-- ç»Ÿè®¡é¢æ¿ -->
    <view class="stats-panel" wx:if="{{currentPanel === 'stats'}}">
        <!-- ç­›é€‰æ—¶é—´ -->
        <view class="filter-header">
            <view class="filter-bar">
                <view class="filter-option {{statsFilterType === 'all' ? 'active' : ''}}" data-type="all" bindtap="onChangeStatsFilter">å…¨éƒ¨</view>
                <view class="filter-option {{statsFilterType === 'month' ? 'active' : ''}}" data-type="month" bindtap="onChangeStatsFilter">è¿‘ä¸€æœˆ</view>
                <view class="filter-option {{statsFilterType === 'year' ? 'active' : ''}}" data-type="year" bindtap="onChangeStatsFilter">è¿‘ä¸€å¹´</view>
                <view class="filter-option {{statsFilterType === 'custom' ? 'active' : ''}}" data-type="custom" bindtap="onChangeStatsFilter">è‡ªå®šä¹‰</view>
            </view>
            <view style="display:flex; gap:12rpx; align-items:center;">
                <view class="export-btn" bindtap="exportExcel">å¯¼å‡ºå…¨éƒ¨</view>
                <view class="refresh-btn" bindtap="refreshAllData">
                    <text>åˆ·æ–°æ•°æ®</text>
                </view>
            </view>
        </view>

        <!-- è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´é€‰æ‹© -->
        <view class="custom-range" wx:if="{{statsFilterType === 'custom'}}">
            <picker mode="date" value="{{customStartDate}}" bindchange="onStartDateChange">
                <view class="date-picker">å¼€å§‹æ—¥æœŸï¼š{{customStartDate || 'è¯·é€‰æ‹©'}}</view>
            </picker>
            <picker mode="date" value="{{customEndDate}}" bindchange="onEndDateChange">
                <view class="date-picker">ç»“æŸæ—¥æœŸï¼š{{customEndDate || 'è¯·é€‰æ‹©'}}</view>
            </picker>
            <button class="apply-btn" bindtap="applyCustomFilter">åº”ç”¨</button>
        </view>

        <!-- çŠ¶æ€æ•°é‡æ±‡æ€» -->
        <view class="status-summary">
            <view class="summary-card pending">
                <view class="sum-label">å¾…å¤„ç†</view>
                <view class="sum-count">{{statsPendingCount}}</view>
            </view>
            <view class="summary-card processing">
                <view class="sum-label">å¤„ç†ä¸­</view>
                <view class="sum-count">{{statsProcessingCount}}</view>
            </view>
            <view class="summary-card completed">
                <view class="sum-label">å·²åŠç»“</view>
                <view class="sum-count">{{statsCompletedCount}}</view>
            </view>
        </view>

        <!-- æ¦‚è§ˆæŒ‡æ ‡ -->
        <view class="overview-row">
            <view class="overview-item">
                <view class="overview-label">æ€»ä¸¾æŠ¥æ•°</view>
                <view class="overview-value">{{totalReports}}</view>
            </view>
            <view class="overview-item">
                <view class="overview-label">è§£å†³ç‡</view>
                <view class="overview-value">{{resolutionRate}}%</view>
            </view>
        </view>

        <!-- éšæ‚£ç±»å‹åˆ†å¸ƒï¼ˆé¥¼å›¾ï¼‰ -->
        <view class="hazard-chart-section">
            <view class="section-title">éšæ‚£ç±»å‹åˆ†å¸ƒ</view>
            <view class="chart-container">
                <canvas class="pie-chart" canvas-id="adminPieChart" style="width: {{canvasWidth || 300}}px; height: {{canvasHeight || 300}}px;"></canvas>
                <view class="chart-legend" wx:if="{{hazardDistribution && hazardDistribution.length > 0}}">
                    <block wx:for="{{hazardDistribution}}" wx:key="name">
                        <view class="legend-item">
                            <view class="legend-color" style="background: {{item.color}};"></view>
                            <text class="legend-label">{{item.name}} {{item.percentage}}%</text>
                        </view>
                    </block>
                </view>
            </view>
        </view>
    </view>

    <!-- çŠ¶æ€åˆ‡æ¢æ ‡ç­¾ -->
    <view class="status-tabs" wx:if="{{currentPanel === 'tasks'}}">
        <view class="status-tab {{currentTab === 'pending' ? 'active' : ''}}" bindtap="switchTab" data-tab="pending">
            <text class="tab-count">{{pendingCount}}</text>
            <text class="tab-label">å¾…å¤„ç†</text>
        </view>
        <view class="status-tab {{currentTab === 'processing' ? 'active' : ''}}" bindtap="switchTab" data-tab="processing">
            <text class="tab-count">{{processingCount}}</text>
            <text class="tab-label">å¤„ç†ä¸­</text>
        </view>
        <view class="status-tab {{currentTab === 'completed' ? 'active' : ''}}" bindtap="switchTab" data-tab="completed">
            <text class="tab-count">{{completedCount}}</text>
            <text class="tab-label">å·²åŠç»“</text>
        </view>
    </view>

    <!-- ä¸¾æŠ¥å·¥å•åˆ—è¡¨ -->
    <view class="reports-container" wx:if="{{currentPanel === 'tasks'}}">
        <!-- å¾…å¤„ç†åˆ—è¡¨ -->
        <view class="reports-list" wx:if="{{currentTab === 'pending'}}">
            <view wx:for="{{pendingReports}}" wx:key="id" class="report-item pending-item" bindtap="showReportDetail" data-id="{{item.id}}">
                <view class="item-header">
                    <view class="item-type">{{item.hazardType}}</view>
                </view>
                <view class="item-desc">{{item.description}}</view>
                <view class="item-meta">
                    <text class="reporter">ä¸¾æŠ¥äºº: {{item.reporter}}</text>
                    <text class="time">{{item.reportTime}}</text>
                </view>
            </view>
            <view class="empty-state" wx:if="{{pendingReports.length === 0}}">
                <text class="empty-text">æš‚æ— å¾…å¤„ç†äº‹é¡¹</text>
            </view>
        </view>

        <!-- å¤„ç†ä¸­åˆ—è¡¨ -->
        <view class="reports-list" wx:if="{{currentTab === 'processing'}}">
            <view wx:for="{{processingReports}}" wx:key="id" class="report-item processing-item" bindtap="showReportDetail" data-id="{{item.id}}">
                <view class="item-header">
                    <view class="item-type">{{item.hazardType}}</view>
                </view>
                <view class="item-desc">{{item.description}}</view>
                <view class="item-meta">
                    <text class="reporter">ä¸¾æŠ¥äºº: {{item.reporter}}</text>
                    <text class="time">{{item.reportTime}}</text>
                </view>
            </view>
            <view class="empty-state" wx:if="{{processingReports.length === 0}}">
                <text class="empty-text">æš‚æ— å¤„ç†ä¸­äº‹é¡¹</text>
            </view>
        </view>

        <!-- å·²åŠç»“åˆ—è¡¨ -->
        <view class="reports-list" wx:if="{{currentTab === 'completed'}}">
            <view wx:for="{{completedReports}}" wx:key="id" class="report-item completed-item" bindtap="showReportDetail" data-id="{{item.id}}">
                <view class="item-header">
                    <view class="item-type">{{item.hazardType}}</view>
                    <view class="item-status confirmed">å·²åŠç»“</view>
                </view>
                <view class="item-desc">{{item.description}}</view>
                <view class="item-meta">
                    <text class="reporter">ä¸¾æŠ¥äºº: {{item.reporter}}</text>
                    <text class="complete-time">{{item.completeTime}}</text>
                </view>
            </view>
            <view class="empty-state" wx:if="{{completedReports.length === 0}}">
                <text class="empty-text">æš‚æ— å·²åŠç»“äº‹é¡¹</text>
            </view>
        </view>

        <!-- åŠ è½½çŠ¶æ€ -->
        <view class="loading" wx:if="{{loading}}">
            <text>åŠ è½½ä¸­...</text>
        </view>
    </view>
</view>
